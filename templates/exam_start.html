<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ exam.title }} - Online Exam</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéì</text></svg>">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 700px;
            width: 100%;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .header h1 {
            color: #333;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .header .subtitle {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }
        
        .exam-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .exam-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .detail-card {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #e1e5e9;
        }
        
        .detail-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .detail-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .detail-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .instructions {
            background: #f0f9ff;
            border: 2px solid #3b82f6;
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
        }
        
        .instructions h3 {
            color: #1e40af;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .instructions-content {
            color: #475569;
            line-height: 1.6;
            white-space: pre-line;
        }
        
        /* Negative Marking Styles */
        .negative-marking-info {
            background: #fef2f2;
            border: 2px solid #ef4444;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
        }
        
        .negative-marking-info h3 {
            color: #dc2626;
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .negative-marking-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .negative-marking-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #fecaca;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .subject-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .subject-icon {
            font-size: 1.2rem;
        }
        
        .subject-name {
            font-weight: 600;
            color: #374151;
        }
        
        .negative-marks {
            background: #dc2626;
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .no-negative {
            background: #10b981;
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .negative-marking-note {
            background: #fff3cd;
            border: 1px solid #fbbf24;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .negative-marking-note p {
            color: #92400e;
            font-size: 0.9rem;
            margin: 0;
            line-height: 1.5;
        }
        
        .candidate-form {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
        }
        
        .candidate-form h3 {
            color: #92400e;
            margin-bottom: 20px;
            font-size: 1.2rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .warning-box {
            background: #fee2e2;
            border: 2px solid #fecaca;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .warning-box h4 {
            color: #dc2626;
            margin-bottom: 10px;
        }
        
        .warning-box ul {
            color: #991b1b;
            margin-left: 20px;
        }
        
        .warning-box li {
            margin-bottom: 5px;
        }
        
        .contact-info {
            background: #f3f4f6;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }
        
        .contact-info h4 {
            color: #374151;
            margin-bottom: 10px;
        }
        
        .contact-info p {
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .back-link {
            display: block;
            text-align: center;
            margin-top: 20px;
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 30px 20px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .exam-details {
                grid-template-columns: 1fr;
            }
            
            .negative-marking-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã {{ exam.title }}</h1>
            <div class="subtitle">{{ exam.department }} - {{ exam.position }}</div>
            <div class="exam-badge">Online Examination</div>
        </div>
        
        <div class="exam-details">
            <div class="detail-card">
                <div class="detail-icon">‚è∞</div>
                <div class="detail-value">{{ exam.time_limit }}</div>
                <div class="detail-label">Minutes</div>
            </div>
            
            <div class="detail-card">
                <div class="detail-icon">üìù</div>
                <div class="detail-value">Multiple</div>
                <div class="detail-label">Question Types</div>
            </div>
            
        </div>
        
        {% if exam.description %}
        <div style="background: #f9fafb; padding: 20px; border-radius: 8px; margin: 20px 0; text-align: center;">
            <h3 style="color: #374151; margin-bottom: 10px;">üìÑ About This Exam</h3>
            <p style="color: #6b7280; line-height: 1.6;">{{ exam.description }}</p>
        </div>
        {% endif %}
        
        <!-- Negative Marking Information -->
        {% if exam.negative_marking_config %}
        {% set has_negative_marking = exam.negative_marking_config.values() | selectattr('enabled', 'equalto', true) | list | length > 0 %}
        {% if has_negative_marking %}
        <div class="negative-marking-info">
            <h3>
                <span>‚ö†Ô∏è</span>
                Negative Marking Policy
            </h3>
            <p style="color: #7f1d1d; margin-bottom: 15px;">
                <strong>Important:</strong> This exam has negative marking for Multiple Choice Questions (MCQs). 
                Wrong answers will deduct marks as shown below:
            </p>
            
            <div class="negative-marking-grid">
                {% for subject, config in exam.negative_marking_config.items() %}
                <div class="negative-marking-item">
                    <div class="subject-info">
                        <span class="subject-icon">
                            {% if subject == 'technical' %}‚öôÔ∏è
                            {% elif subject == 'english' %}üá¨üáß
                            {% elif subject == 'mathematics' %}üî¢
                            {% elif subject == 'bengali' %}üáßüá©
                            {% elif subject == 'general_knowledge' %}üåç
                            {% elif subject == 'logical_reasoning' %}üß†
                            {% else %}üìù{% endif %}
                        </span>
                        <span class="subject-name">{{ subject.replace('_', ' ').title() }}</span>
                    </div>
                    {% if config.enabled %}
                    <span class="negative-marks">-{{ config.mcq_negative_marks }} marks</span>
                    {% else %}
                    <span class="no-negative">No Negative</span>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            
            <div class="negative-marking-note">
                <p>
                    <strong>üìå Note:</strong> Negative marking only applies to Multiple Choice Questions (MCQs). 
                    Short answer and essay questions are not affected by negative marking. 
                    If you're unsure of an MCQ answer, consider leaving it blank to avoid losing marks.
                </p>
            </div>
        </div>
        {% endif %}
        {% endif %}
        
        <div class="instructions">
            <h3>üìã Exam Instructions</h3>
            <div class="instructions-content">{{ exam.instructions or 'Please read all questions carefully and answer to the best of your ability.' }}</div>
        </div>
        
        <div class="warning-box">
            <h4>‚ö†Ô∏è Important Guidelines</h4>
            <ul>
                <li><strong>Stable Internet:</strong> Ensure you have a stable internet connection throughout the exam</li>
                <li><strong>No Refresh:</strong> Do not refresh the page during the exam as it may cause data loss</li>
                <li><strong>Single Attempt:</strong> You can only take this exam once, so prepare well</li>
                <li><strong>Auto-Submit:</strong> The exam will auto-submit when time expires</li>
                <li><strong>Technical Issues:</strong> Contact support immediately if you face any problems</li>
                {% if exam.negative_marking_config %}
                {% set has_negative_marking = exam.negative_marking_config.values() | selectattr('enabled', 'equalto', true) | list | length > 0 %}
                {% if has_negative_marking %}
                <li><strong>Negative Marking:</strong> Be careful with MCQ answers - wrong answers will deduct marks</li>
                {% endif %}
                {% endif %}
            </ul>
        </div>
        
        <div class="candidate-form">
            <h3>üë§ Candidate Information</h3>
            {% if error %}
            <div style="background: #fee2e2; color: #dc2626; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ef4444;">
                <strong>‚ùå Error:</strong> {{ error }}
            </div>
            {% endif %}
            <form method="POST" action="/exam/{{ exam_link }}/start" id="candidateForm">
                <div class="form-group">
                    <label for="candidate_name">üìù Full Name *</label>
                    <input type="text" id="candidate_name" name="candidate_name" required 
                           placeholder="Enter your full name">
                </div>
                
                <div class="form-group">
                    <label for="candidate_id">üÜî Candidate ID *</label>
                    <input type="text" id="candidate_id" name="candidate_id" required 
                           placeholder="Enter your candidate/student ID">
                </div>
                
                <div style="margin: 20px 0;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="agreeTerms" required style="width: auto;">
                        <span>I have read and understood the instructions and agree to the exam terms</span>
                    </label>
                </div>
                
                <div style="margin: 20px 0;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="confirmReady" required style="width: auto;">
                        <span>I confirm that I am ready to start the exam and understand that the timer will begin immediately</span>
                    </label>
                </div>
                
                {% if exam.negative_marking_config %}
                {% set has_negative_marking = exam.negative_marking_config.values() | selectattr('enabled', 'equalto', true) | list | length > 0 %}
                {% if has_negative_marking %}
                <div style="margin: 20px 0;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="acknowledgeNegative" required style="width: auto;">
                        <span>I understand the negative marking policy and accept the risk of mark deduction for wrong MCQ answers</span>
                    </label>
                </div>
                {% endif %}
                {% endif %}
                
                <button type="submit" class="btn" id="startBtn" disabled>
                    üöÄ Start Exam Now
                </button>
            </form>
        </div>
        
        <div class="contact-info">
            <h4>üÜò Need Technical Support?</h4>
            <p><strong>Email:</strong> support@examportal.com</p>
            <p><strong>Phone:</strong> +1 (555) 123-4567</p>
            <p><strong>Available 24/7 during exam periods</strong></p>
        </div>

        <div style="background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 8px; padding: 15px; margin-top: 20px; text-align: center;">
            <p style="color: #0369a1; margin: 0;">
                <strong>Already submitted your exam?</strong>
                <a href="/exam/{{ exam_link }}/results" style="color: #0284c7; text-decoration: underline;">Check your results here</a>
            </p>
        </div>

        <a href="/" class="back-link">‚Üê Back to Home</a>
    </div>
    
    <script>
        // Enable start button only when all checkboxes are checked
        function checkReadiness() {
            const agreeTerms = document.getElementById('agreeTerms').checked;
            const confirmReady = document.getElementById('confirmReady').checked;
            const acknowledgeNegative = document.getElementById('acknowledgeNegative');
            const acknowledgeNegativeChecked = acknowledgeNegative ? acknowledgeNegative.checked : true;
            const nameField = document.getElementById('candidate_name').value.trim();
            const idField = document.getElementById('candidate_id').value.trim();
            
            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = !(agreeTerms && confirmReady && acknowledgeNegativeChecked && nameField && idField);
            
            if (startBtn.disabled) {
                startBtn.style.background = '#9ca3af';
                startBtn.textContent = 'üöÄ Complete all fields to start';
            } else {
                startBtn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                startBtn.textContent = 'üöÄ Start Exam Now';
            }
        }
        
        // Add event listeners
        document.getElementById('agreeTerms').addEventListener('change', checkReadiness);
        document.getElementById('confirmReady').addEventListener('change', checkReadiness);
        const acknowledgeNegative = document.getElementById('acknowledgeNegative');
        if (acknowledgeNegative) {
            acknowledgeNegative.addEventListener('change', checkReadiness);
        }
        document.getElementById('candidate_name').addEventListener('input', checkReadiness);
        document.getElementById('candidate_id').addEventListener('input', checkReadiness);
        
        // Form submission handling
        document.getElementById('candidateForm').addEventListener('submit', function(e) {
            const nameField = document.getElementById('candidate_name').value.trim();
            const idField = document.getElementById('candidate_id').value.trim();
            const agreeTerms = document.getElementById('agreeTerms').checked;
            const confirmReady = document.getElementById('confirmReady').checked;
            const acknowledgeNegative = document.getElementById('acknowledgeNegative');
            const acknowledgeNegativeChecked = acknowledgeNegative ? acknowledgeNegative.checked : true;
            
            // Validate fields
            if (!nameField || !idField || !agreeTerms || !confirmReady || !acknowledgeNegativeChecked) {
                e.preventDefault();
                alert('‚ùå Please fill in all required fields and check all confirmation boxes.');
                return;
            }
            
            let confirmMessage = '‚ö†Ô∏è Are you ready to start the exam?\n\nOnce you click "OK":\n- The timer will start immediately\n- You cannot pause or restart\n- Make sure you have a stable internet connection';
            
            // Add negative marking warning if applicable
            const negativeMarkingExists = document.getElementById('acknowledgeNegative');
            if (negativeMarkingExists) {
                confirmMessage += '\n- Remember: Wrong MCQ answers will result in negative marks';
            }
            
            confirmMessage += '\n\nProceed?';
            
            if (!confirm(confirmMessage)) {
                e.preventDefault();
                return;
            }
            
            // Show loading state
            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = true;
            startBtn.textContent = 'üîÑ Starting Exam...';
            startBtn.style.background = '#9ca3af';
        });
        
        // Auto-focus on name field
        document.getElementById('candidate_name').focus();
        
        // Prevent accidental navigation away
        window.addEventListener('beforeunload', function(e) {
            e.preventDefault();
            e.returnValue = '';
        });
        
        // Initialize check
        checkReadiness();
        
        // Add some exam preview information
        function showSystemCheck() {
            alert('üîß System Check:\n\n‚úÖ Browser: Compatible\n‚úÖ JavaScript: Enabled\n‚úÖ Internet: Connected\n\nYou are ready to take the exam!');
        }
        
        // Add system check button
        const systemCheckBtn = document.createElement('button');
        systemCheckBtn.textContent = 'üîß Test System Compatibility';
        systemCheckBtn.style.cssText = `
            width: 100%;
            padding: 12px;
            background: #f3f4f6;
            color: #374151;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        `;
        systemCheckBtn.addEventListener('click', function(e) {
            e.preventDefault();
            showSystemCheck();
        });
        systemCheckBtn.addEventListener('mouseenter', function() {
            this.style.background = '#e5e7eb';
            this.style.borderColor = '#9ca3af';
        });
        systemCheckBtn.addEventListener('mouseleave', function() {
            this.style.background = '#f3f4f6';
            this.style.borderColor = '#d1d5db';
        });
        
        // Insert system check button before the start button
        const startBtn = document.getElementById('startBtn');
        startBtn.parentNode.insertBefore(systemCheckBtn, startBtn);
        
        // Auto-save candidate info (in case of accidental refresh)
        function autoSave() {
            const name = document.getElementById('candidate_name').value;
            const id = document.getElementById('candidate_id').value;
            if (name || id) {
                localStorage.setItem('candidate_info', JSON.stringify({name, id}));
            }
        }
        
        // Load saved candidate info
        function loadSavedInfo() {
            const saved = localStorage.getItem('candidate_info');
            if (saved) {
                const {name, id} = JSON.parse(saved);
                if (name) document.getElementById('candidate_name').value = name;
                if (id) document.getElementById('candidate_id').value = id;
                checkReadiness();
            }
        }
        
        // Add auto-save listeners
        document.getElementById('candidate_name').addEventListener('input', autoSave);
        document.getElementById('candidate_id').addEventListener('input', autoSave);
        
        // Load saved info on page load
        loadSavedInfo();
        
        // Clear saved info when starting exam
        document.getElementById('candidateForm').addEventListener('submit', function() {
            localStorage.removeItem('candidate_info');
        });
        
        // Display current time for reference
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleString();
            const clockDiv = document.getElementById('currentTime');
            if (clockDiv) {
                clockDiv.textContent = `Current Time: ${timeString}`;
            }
        }
        
        // Add clock display
        const clockDiv = document.createElement('div');
        clockDiv.id = 'currentTime';
        clockDiv.style.cssText = `
            text-align: center;
            color: #6b7280;
            font-size: 0.9rem;
            margin: 15px 0;
            padding: 10px;
            background: #f9fafb;
            border-radius: 6px;
        `;
        document.querySelector('.candidate-form').appendChild(clockDiv);
        
        updateClock();
        setInterval(updateClock, 1000);
    </script>
</body>
</html>